quarkus.datasource.db-kind=h2
quarkus.datasource.jdbc.url=jdbc:h2:mem:test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
quarkus.datasource.username=sa
quarkus.datasource.password=sa
quarkus.datasource.jdbc.telemetry=true

# Hibernate schema management
quarkus.hibernate-orm.database.generation=validate
quarkus.hibernate-orm.log.sql=false

# Flyway migrations
quarkus.flyway.migrate-at-start=true
quarkus.flyway.locations=db/migration

# REST and dev settings
quarkus.http.test-port=0

# Swagger UI (zobraz aj mimo dev, napr. pri spustení jar)
quarkus.swagger-ui.always-include=true

# -------- Kafka connection --------
# For local development it defaults to localhost:9092.
# In Kubernetes, override via ConfigMap or the KAFKA_BOOTSTRAP_SERVERS env var (e.g., kafka:9092).
mp.messaging.connector.smallrye-kafka.bootstrap.servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# -------- Incoming channel from Kafka --------
# Logický názov kanálu: "ktop-in"
mp.messaging.incoming.ktop-in.connector=smallrye-kafka
mp.messaging.incoming.ktop-in.topic=my.first.topic
mp.messaging.incoming.ktop-in.value.deserializer=sk.lorman.pokus.ewg.kafka.StartupMessageDtoDeserializer
mp.messaging.incoming.ktop-in.auto.offset.reset=earliest

# Consumer group
mp.messaging.incoming.ktop-in.group.id=quarkus-ktop-consumer

# -------- Outgoing channel to Kafka --------
# Logický názov kanálu: "ktop-out"
mp.messaging.outgoing.ktop-out.connector=smallrye-kafka
mp.messaging.outgoing.ktop-out.topic=my.first.topic
mp.messaging.outgoing.ktop-out.value.serializer=io.quarkus.kafka.client.serialization.ObjectMapperSerializer
# --- Topic creation for development: ensure 2 partitions for producer topic ---
# Allow the connector to auto-create topics if the broker permits it (e.g., Redpanda)
mp.messaging.connector.smallrye-kafka.allow.topic.creation=true
# Create the outgoing topic with 2 partitions so we can route by partition (0/1)
mp.messaging.outgoing.ktop-out.topic.partitions=2
mp.messaging.outgoing.ktop-out.topic.replication.factor=1
# -------- Dev profile: use SmallRye in-memory connector instead of Kafka --------
# In dev mode we wire the outgoing channel "ktop-out" to the incoming channel "ktop-in"
# using the SmallRye in-memory connector. This allows local development without a Kafka broker.
%dev.mp.messaging.outgoing.ktop-out.connector=smallrye-in-memory
%dev.mp.messaging.incoming.ktop-in.connector=smallrye-in-memory
# Route messages sent to the outgoing channel to the incoming channel
%dev.mp.messaging.incoming.ktop-in.source=ktop-out

# -------- Custom application properties --------
# Random value generated at startup (uses SmallRye Config random expressions)
app.random=nr1

# -------- Logging (JSON output for ELK) --------
# Default: human-readable console logs locally. Set to true to enable JSON logs.
quarkus.log.console.json=false
# When JSON is enabled, include common fields suitable for ELK ingestion
quarkus.log.console.json.fields=timestamp,level,loggerName,threadName,message,mdc,exception
# Use short level names (INFO, WARN, ERROR)
quarkus.log.console.json.level=info
# Customize JSON field names (optional, good defaults for ELK)
quarkus.log.console.json.field-names.timestamp=@timestamp
quarkus.log.console.json.field-names.level=level
quarkus.log.console.json.field-names.loggerName=logger
quarkus.log.console.json.field-names.threadName=thread
quarkus.log.console.json.field-names.message=message
quarkus.log.console.json.field-names.mdc=mdc
quarkus.log.console.json.exception-output-type=formatted

# -------- Graceful shutdown --------
# Total time Quarkus will wait for ongoing work to complete during shutdown
quarkus.shutdown.timeout=30s
# When enabled, new HTTP requests are rejected during shutdown while in-flight ones are allowed to complete
quarkus.http.graceful-shutdown=true
# -------- OpenTelemetry Tracing --------
# Enable OpenTelemetry and export traces to OTLP endpoint (Jaeger in Helm by default)
quarkus.otel.enabled=true
quarkus.otel.traces.exporter=cdi
# Set the service name for better identification in Jaeger
quarkus.otel.resource.attributes=service.name=pokus-ewg,service.version=1.0.0-SNAPSHOT
# Default OTLP endpoint (can be overridden via env OTEL_EXPORTER_OTLP_ENDPOINT)
# When running in Kubernetes with the provided Helm chart, the service name is 'jaeger'
quarkus.otel.exporter.otlp.endpoint=${OTEL_EXPORTER_OTLP_ENDPOINT:http://jaeger:4317}
